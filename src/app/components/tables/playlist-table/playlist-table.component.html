<div *ngIf="tracksLoaded" class="playlist">
  <div class="playlistHeader">
    <div class="playlistCoverSection">
      <img class="playlistCoverImage" [src]="playlistCover" />
    </div>
    <div class="playlistInfoSection">
      <span>PLAYLIST</span>
      <h1>{{playlistName}}</h1>
      <span>Created by {{playlistOwner}} * {{tracks.length}} <span *ngIf="tracks.length > 1 || tracks.length === 0">songs</span><span *ngIf="tracks.length === 1">song</span>, {{getPlaylistDuration()}}</span>
    </div>
  </div>
  <div *ngIf="tracks.length === 0">
    There are no tracks in this playlist
  </div>
  <div class="trackData" *ngIf="tracks.length > 0">
    <div>
      <app-track-filter [tracks]="source" [selectedTracks]="selection"></app-track-filter>
    </div>
    <table mat-table [dataSource]="dataSource" matSort (matSortChange)="sortData($event)">
      <ng-container matColumnDef="dupTrack" *ngIf="checkDuplicate">
        <th mat-header-cell *matHeaderCellDef class="dupliateTrackHeader">Dup</th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)">
          </mat-checkbox>
        </td>
      </ng-container>

      <ng-container matColumnDef="trackPlaying">
        <th mat-header-cell *matHeaderCellDef class="trackPlayingHeader"></th>
        <td mat-cell *matCellDef="let element" class="trackPlayIcons">
          <mat-icon *ngIf="element.isPlayButtonShowing && currentTrack['name'] !== element.title" (click)="testing(element.track)">play_circle_filled_white</mat-icon>
          <mat-icon *ngIf="element.isPlayButtonShowing && (currentTrack['name'] === element.title && currentTrack['album']['name'] !== element.album)" (click)="testing(element.track)">play_circle_filled_white</mat-icon>
          <div *ngIf="(currentTrack['name'] === element.title && currentTrack['album']['name'] === element.album)" (mouseleave)="hidePauseButton(element)" (mouseenter)="showPauseButton(element)">
            <div *ngIf="!element.isPauseButtonShowing">
              <mat-icon>volume_up</mat-icon>
            </div>
            <mat-icon *ngIf="element.isPauseButtonShowing" (click)="pauseSong(element.track)">pause_circle_filled</mat-icon>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
        <td mat-cell *matCellDef="let element"> {{shortenString(element.title, 50)}} </td>
      </ng-container>
    
      <ng-container matColumnDef="artist">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Artist</th>
        <td mat-cell *matCellDef="let element"> {{shortenString(element.artist, 35)}} </td>
      </ng-container>
    
      <ng-container matColumnDef="album">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Album</th>
        <td mat-cell *matCellDef="let element"> {{shortenString(element.album, 35)}} </td>
      </ng-container>

      <ng-container matColumnDef="addedAt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <mat-icon>calendar_today</mat-icon>
        </th>
        <td mat-cell *matCellDef="let element"> {{element.addedAt}} </td>
      </ng-container>
    
      <ng-container matColumnDef="time">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <mat-icon>watch_later</mat-icon>
        </th>
        <td mat-cell *matCellDef="let element"> {{element.time}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="getDisplayedColumns(); sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: getDisplayedColumns();" (mouseleave)="hidePlayButton(row)" (mouseenter)="showPlayButton(row)" [className]="(currentTrack['name'] === row.title && currentTrack['album']['name'] === row.album) ? 'trackPlaying mat-row' : 'mat-row'"></tr>
    </table>
  </div>
</div>
<mat-spinner class="loadingContainer" *ngIf="loading"></mat-spinner>
